##### æ™ºèƒ½å•†å“ç»“ç®—ç³»ç»Ÿ

éœ€æ±‚æ˜¯é«˜ç²¾åº¦ï¼ŒåŠ¨æ€ç±»åˆ«ï¼Œå®ç°ç»“ç®—å•†å“ç³»ç»Ÿï¼Œ

æˆ‘ç›®å‰æ˜¯çš„æ€è·¯æ˜¯å°†å•†å“åˆ†ä¸ºä¸€ä¸ªå¤§ç±»ï¼Œå¦‚æœç“¶è£…ï¼Œç›’è£…ï¼Œè¢‹è£…ï¼Œç½è£…ï¼Œè¿™ç§å¤§ç±»ï¼Œæ¯ä¸ªå¤§ç±»æœ‰ä¸åŒçš„å°ç±»ï¼Œå¦‚è®­ç»ƒæ—¶ç“¶è£…ç”¨å†œå¤«å±±æ³‰ï¼Œæ€¡å®ï¼Œæµ‹è¯•æ—¶å€™å°±æ˜¯å“‡å“ˆå“ˆï¼Œæ•´ä¸ªé¡¹ç›®é¦–å…ˆæ˜¯ç”¨`yolov8`åˆ†å‰²æ¨¡å‹å¹¶æå–åˆ°è¯¥ç±»åˆ«ï¼Œç„¶åé€šè¿‡ç‰¹å¾æå–æ¨¡å‹çš„è¾“å‡ºä¸ç‰¹å¾æ³¨å†Œåº“è¿›è¡ŒåŒ¹é…ï¼Œä½¿ç”¨ä½™å¼¦è·ç¦»è¿›è¡Œè®¡ç®—ï¼Œéœ€è¦è§£å†³çš„æ˜¯ç±»åˆ«ä¸å›ºå®šé—®é¢˜ï¼Œæ¯”å¦‚åæœŸè¿›è´§æ–°å“éš¾é“è¿˜è¦è®­ç»ƒæ¨¡å‹å˜›ï¼Ÿæ‰€ä»¥éœ€è¦è§£å†³æ¨¡å‹é¢‘ç¹æ›´æ–°é—®é¢˜ï¼Œç‰¹å¾æå–æ¨¡å‹è¦èƒ½å¤Ÿè¯†åˆ«å‡ºåŒä¸€ç±»åˆ«ä¸‹ä¸åŒå¯¹è±¡çš„å·®å¼‚æ€§ï¼Œæ¯”å¦‚äººè„¸ï¼Œä¸­å›½äººï¼Œæ—¥æœ¬äººï¼Œç¾å›½äººï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œåº”è¯¥å…·æœ‰è¯†åˆ«åŒä¸€ç±»æ°´ï¼Œä¸åŒçš„å¯¹è±¡ï¼Œå¯å£å¯ä¹ï¼Œç™¾äº‹å¯ä¹ï¼Œå¯¹æ¨¡å‹çš„ç‰¹å¾æå–èƒ½åŠ›è¦æ±‚è¾ƒé«˜ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥æ˜¯é‡‡ç”¨`ArcLoss`ï¼Œå½“è¿›è´§çš„å•†å“æ˜¯æ–°å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡æ³¨å†Œåˆ°ç‰¹å¾åº“ä¸­ï¼Œé€šè¿‡ä¸åŒçš„è§’åº¦è¿›è¡Œæ³¨å†Œå°±å¯å°±è¡Œï¼Œè¿™æ ·å¤§å¤§çš„å‡å°‘äº†æ¨¡å‹é¢‘ç¹æ›´æ–°çš„é—®é¢˜ï¼Œç±»åˆ«çš„å›ºå®šæˆ‘è®¤ä¸ºæ˜¯è¾“å‡ºå±‚å¯¼è‡´çš„ï¼Œä¸ä¸»å¹²ç½‘ç»œæ— å…³ï¼Œä¸»å¹²ç½‘ç»œåªæ˜¯ç‰¹å¾çš„æå–ï¼ŒæŠŠä¸»å¹²å’Œè¾“å‡ºåˆ†å¼€åšï¼Œé™åˆ¶ç±»åˆ«å›ºå®šçš„æ˜¯`one-hot`ç›´æ¥ä½¿ç”¨`label`å°±è¡Œï¼Œè¿˜æœ‰å°±æ˜¯å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¥½çš„å›¾åƒç‰¹å¾æå–æ¨¡å‹ï¼Ÿè¶³å¤Ÿæ·±å¾—ç½‘ç»œå’Œ`ArcLoss`ï¼Œä»¥åŠå¤§é‡å¾—æ•°æ®é›†ï¼Œç‰¹å¾æ³¨å†Œéƒ¨åˆ†ï¼Œå¯ä»¥é‡‡ç”¨æ•°æ®åº“ï¼Œæˆ–è€…txtï¼Ÿè¿™ä¸ªåœ°æ–¹ä¹Ÿéœ€è¦å¥½å¥½è€ƒè™‘è®¾è®¡ï¼Œå› ä¸ºè¿™é‡Œå’Œé‡‘é’±æŒ‚é’©ï¼Œè¿˜æœ‰å°±æ˜¯ç‰¹å¾å‘é‡å’Œæ³¨å†Œåº“å¾—ç‰¹å¾å‘é‡å¾—åŒ¹é…ç½®ä¿¡åº¦ï¼Œéœ€è¦è¾¾åˆ°0.9åŠä»¥ä¸Šï¼ŒåŒæ—¶éœ€è¦å¤šå¸§è¿ç»­æ£€æµ‹ï¼Œç»Ÿè®¡é¢‘ç‡æœ€é«˜å¾—ï¼Œé€å…¥ç‰¹å¾æå–æ¨¡å‹å¾—æ•°æ®é›†ä¹Ÿæ˜¯éå¸¸é‡è¦å¾—ï¼Œåªæœ‰åˆ†å‰²æ‰èƒ½å»å™ªåˆ°æœ€å¥½ï¼Œéœ€è¦æŠ å›¾ï¼ŒåŒæ—¶éœ€è¦å°†æŠ å›¾å¾—å•†å“è¿›è¡Œæ‘†æ­£ï¼Œé€šè¿‡è®¡ç®—`opencv`æœ€å°å¤–æ¥çŸ©å½¢ï¼Œå¹¶çŸ¥é“å¾—è§’åº¦ï¼Œé€šè¿‡è§’åº¦å®ç°ç»Ÿä¸€ï¼Œè¿˜æœ‰å°±æ˜¯ç»Ÿä¸€ç¼©æ”¾ä¸ºæ­£æ–¹å½¢ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨`yolo`å®˜æ–¹çš„ç®—å­å€Ÿé‰´å®ç°ï¼Œå·ç§¯å¯¹ä¸­å¿ƒæ©¡ç´ çš„ç‰¹å¾æå–èƒ½åŠ›å¼ºï¼Œå¯¹è¾¹ç¼˜ç‰¹å¾æå–èƒ½åŠ›å¼±ï¼Œéœ€è¦æƒ³åŠæ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©å»ç¼©æ”¾åœ¨ä¸­å¿ƒä½ç½®ï¼Œæˆ–åˆ™å¯ä»¥è€ƒè™‘å…ˆæ‘†æ­£åå†é€šè¿‡æœ€å¤§çš„å¤–æ¥çŸ©å½¢å‰ªåˆ‡åˆ°ä¸€ä¸ªé»‘è‰²è’™ç‰ˆä¸Šè´´å›¾ä¸Šå»ï¼Ÿ

ä¸€ä¸ªå¥½çš„ç‰¹å¾æå–ç½‘ç»œï¼Œéœ€è¦è¶³å¤Ÿæ·±ï¼Œå¦‚resnet50ä»¥ä¸Šï¼Œç‰¹å¾å‘é‡ç»´åº¦ä¸èƒ½ä½äº512ï¼Œç”šè‡³æ›´é«˜ï¼Œè®­ç»ƒç‰¹å¾æå–æ¨¡å‹å¯ä»¥ä½¿ç”¨`NLLLoss+ArcLoss`ï¼Œå‰ç«¯äº¤äº’ç•Œé¢ä½¿ç”¨`python Qt`

```python
[æ‘„åƒå¤´è¾“å…¥]
     â†“
[YOLOv8-Segmentation æ¨¡å‹] â†’ æå–å•†å“Maskå¹¶æŠ å›¾
     â†“
[å›¾åƒé¢„å¤„ç†æ¨¡å—] â†’ æ‘†æ­£ + è£å‰ª + å½’ä¸€åŒ–
     â†“
[ä¸»å¹²ç‰¹å¾æå–æ¨¡å‹] â†’ ResNet50 / ConvNeXt / ViT + ArcFace Head
     â†“
[ç‰¹å¾å‘é‡] â†’ (512~1024ç»´)
     â†“
[ç‰¹å¾åŒ¹é…å¼•æ“] â†â†’ [ç‰¹å¾æ³¨å†Œæ•°æ®åº“]
     â†“
[å†³ç­–å¼•æ“ï¼šå¤šå¸§æŠ•ç¥¨ + ç½®ä¿¡åº¦é˜ˆå€¼]
     â†“
[Qt å‰ç«¯ç•Œé¢æ˜¾ç¤ºç»“æœ + è®¡ä»·]
     â†“
[ç»“ç®—å®Œæˆ / å¼‚å¸¸æç¤º]
```

### å¤šå¸§èåˆå†³ç­–æœºåˆ¶ï¼ˆé˜²æŠ–åŠ¨ã€æå‡†ç¡®ç‡ï¼‰

å•å¸§å®¹æ˜“è¯¯åˆ¤ï¼Œé‡‡ç”¨ **æ—¶é—´çª—å£æŠ•ç¥¨æœºåˆ¶**

#### ç­–ç•¥ï¼š

- è¿ç»­é‡‡é›† 3~5 å¸§
- æ¯å¸§è¾“å‡ºä¸€ä¸ªé¢„æµ‹ç»“æœï¼ˆå«ç½®ä¿¡åº¦ï¼‰
- ç»Ÿè®¡æœ€é«˜é¢‘æ¬¡ä¸”å¹³å‡ç½®ä¿¡åº¦ > 0.9 çš„ç»“æœ
- è‹¥ä¸ä¸€è‡´ â†’ æç¤ºâ€œè¯·é‡æ–°æ”¾ç½®å•†å“â€

### å‰ç«¯äº¤äº’è®¾è®¡ï¼ˆPyQt5/6ï¼‰

#### ä¸»è¦åŠŸèƒ½ï¼š

- å®æ—¶è§†é¢‘æµæ˜¾ç¤º
- å•†å“è¯†åˆ«ç»“æœæµ®åŠ¨æ¡†
- è®¡ä»·é¢æ¿ï¼ˆæ€»ä»·ã€æ¸…å•ï¼‰
- æ³¨å†Œæ–°å•†å“æŒ‰é’®ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
- æ—¥å¿—è®°å½•ï¼ˆäº¤æ˜“æµæ°´ï¼‰

#### æ•°æ®åº“

**SQLite + FAISSï¼ˆç‹¬ç«‹ç´¢å¼•ï¼‰**

##### å•†å“ä¸»è¡¨

```sql
CREATE TABLE products (
    id TEXT PRIMARY KEY,           -- å•†å“å”¯ä¸€IDï¼Œå¦‚ B001, C002
    name TEXT NOT NULL,            -- åç§°ï¼šå†œå¤«å±±æ³‰ 550ml
    price REAL NOT NULL,           -- ä»·æ ¼ï¼ˆå•ä½ï¼šå…ƒï¼‰
    category TEXT NOT NULL,        -- å¤§ç±»ï¼šbottle, box, bag, can
    image_count INTEGER DEFAULT 1, -- æ³¨å†Œæ—¶ä½¿ç”¨çš„å›¾åƒæ•°é‡
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

##### ç‰¹å¾æ¨¡æ¿è¡¨

```sql
CREATE TABLE feature_templates (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    product_id TEXT NOT NULL,
    angle INTEGER DEFAULT 0,       -- æ‹æ‘„è§’åº¦ï¼ˆå¯é€‰ï¼‰
    feature_data BLOB NOT NULL,    -- å­˜å‚¨ numpy array (pickle.dumps)
    FOREIGN KEY (product_id) REFERENCES products(id)
);
```

å¯ä»¥ä¸ºæ¯ä¸ªå•†å“æ³¨å†Œå¤šä¸ªè§’åº¦çš„ç‰¹å¾ï¼Œè¯†åˆ«æ—¶å–å¹³å‡æˆ–æœ€å¤§ç›¸ä¼¼åº¦ã€‚

å»ºè¡¨å‘½ä»¤

```sql
-- è®¾ç½®å®¢æˆ·ç«¯å­—ç¬¦é›†
SET NAMES utf8mb4;

-- åˆ‡æ¢åˆ°åä¸º feature_database çš„æ•°æ®åº“
USE feature_database;

-- ------------------------------
-- 1. åˆ›å»ºä¸»è¡¨ï¼šproductsï¼ˆå•†å“ä¿¡æ¯ï¼‰
-- ------------------------------
CREATE TABLE products (
    id VARCHAR(32) PRIMARY KEY,                    -- å•†å“å”¯ä¸€IDï¼Œå¦‚ B001, C002
    name VARCHAR(128) NOT NULL,                   -- å•†å“åç§°ï¼šå†œå¤«å±±æ³‰ 550ml
    price DECIMAL(10,2) NOT NULL,                 -- ç²¾ç¡®ä»·æ ¼ï¼ˆå•ä½ï¼šå…ƒï¼‰
    category VARCHAR(32) NOT NULL,                -- å¤§ç±»ï¼šbottle, box, bag, can
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP, -- åˆ›å»ºæ—¶é—´
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP -- ä¿®æ”¹æ—¶é—´
) ENGINE=InnoDB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_general_ci;

-- ä¸º category å­—æ®µæ·»åŠ ç´¢å¼•ï¼ˆåŠ å¿«æŒ‰ç±»åˆ«æŸ¥è¯¢ï¼‰
CREATE INDEX idx_category ON products(category);

-- ------------------------------
-- 2. åˆ›å»ºå‰¯è¡¨ï¼šfeature_templatesï¼ˆç‰¹å¾æ¨¡æ¿ï¼‰
-- ------------------------------
CREATE TABLE feature_templates (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,         -- ç‰¹å¾å”¯ä¸€IDï¼ˆè‡ªå¢ï¼‰
    product_id VARCHAR(32) NOT NULL,              -- å…³è”ä¸»è¡¨å•†å“ID
    category VARCHAR(32) NOT NULL,                -- å¤§ç±»ï¼ˆç”¨äºå¿«é€Ÿè¿‡æ»¤ï¼Œé¿å…JOINï¼‰
    feature_data MEDIUMBLOB NOT NULL,             -- å­˜å‚¨ç‰¹å¾å‘é‡ï¼ˆå¦‚512ç»´float32ï¼‰
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP, -- åˆ›å»ºæ—¶é—´

    -- å¤–é”®çº¦æŸï¼šç¡®ä¿ç‰¹å¾å¿…é¡»å¯¹åº”ä¸€ä¸ªå­˜åœ¨çš„å•†å“
    CONSTRAINT fk_product_id 
        FOREIGN KEY (product_id) 
        REFERENCES products(id) 
        ON DELETE CASCADE, -- åˆ é™¤å•†å“æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å…¶æ‰€æœ‰ç‰¹å¾

    -- ç´¢å¼•ï¼šåŠ å¿«æŒ‰å•†å“IDå’Œç±»åˆ«æŸ¥è¯¢
    INDEX idx_product_id (product_id),
    INDEX idx_ft_category (category)
) ENGINE=InnoDB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_general_ci;
```

è¡¨

```sql
-- 1. æ¸…ç©ºè¡¨å¹¶é‡ç½®è‡ªå¢ID
TRUNCATE TABLE feature_templates;

-- 1. åˆ é™¤æ‰€æœ‰æ•°æ®
DELETE FROM feature_templates;

-- 2. é‡ç½®è‡ªå¢è®¡æ•°å™¨
ALTER TABLE feature_templates AUTO_INCREMENT = 1;
```



ä¸»è¡¨IDé€šè¿‡è®¾è®¡è‡ªå¢è¡¨å®ç°

| ä¸­æ–‡ | è‹±æ–‡ç±»åˆ«  | å»ºè®® ID å‰ç¼€ |
| ---- | --------- | ------------ |
| ç“¶è£… | bottle    | B            |
| ç›’è£… | box       | X            |
| ç½è£… | can       | C            |
| è¢‹è£… | soft_pack | S            |

è®¾è®¡è®¡ç®—è¡¨

```sql
-- ------------------------------
-- 3. åˆ›å»ºè®¡æ•°å™¨è¡¨ï¼šid_counterï¼ˆç”¨äºç”Ÿæˆå¸¦å‰ç¼€çš„è‡ªå¢IDï¼‰
-- ------------------------------
CREATE TABLE id_counter (
    category_prefix CHAR(1) PRIMARY KEY,        -- å‰ç¼€å­—ç¬¦ï¼šB, X, C, S
    category_name   VARCHAR(32) NOT NULL,       -- å¯¹åº”çš„ç±»åˆ«åï¼šbottle, box, can, soft_pack
    next_id         INT NOT NULL DEFAULT 1,     -- ä¸‹ä¸€ä¸ªç¼–å·ï¼ˆä»1å¼€å§‹ï¼‰
    created_time    DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_time    DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    -- ç¡®ä¿ category_name å”¯ä¸€
    UNIQUE KEY uk_category_name (category_name)
) ENGINE=InnoDB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_general_ci;

-- ------------------------------
-- 4. åˆå§‹åŒ–è®¡æ•°å™¨æ•°æ®
-- ------------------------------
INSERT INTO id_counter (category_prefix, category_name, next_id) VALUES
('B', 'bottle',     1),
('X', 'box',        1),
('C', 'can',        1),
('S', 'soft_pack',  1);
```

è®¾è®¡å‘é‡è‡ªå¢è¡¨

```python
CREATE TABLE feature_mappings (
    feature_id INT AUTO_INCREMENT PRIMARY KEY,
    product_id VARCHAR(50) NOT NULL,
     created_time    DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_time    DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_product_id (product_id)
);
```



##### é¡¹ç›®æ¶æ„

```python
fruit_classifier/
â”‚
â”œâ”€â”€ config/                       # ğŸ“„ é…ç½®æ–‡ä»¶ï¼ˆYAMLæ ¼å¼ï¼‰
â”‚   â”œâ”€â”€ train.yaml                # è®­ç»ƒé…ç½®ï¼ˆæ¨¡å‹ã€æ•°æ®ã€è¶…å‚ï¼‰
â”‚   â”œâ”€â”€ infer.yaml                # æ¨ç†é…ç½®ï¼ˆæ‘„åƒå¤´ã€é˜ˆå€¼ã€è·¯å¾„ï¼‰
â”‚   â””â”€â”€ database.yaml             # æ•°æ®åº“ä¸å­˜å‚¨è·¯å¾„
â”‚
â”œâ”€â”€ data/                         # ğŸ“ æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ dataset.py                # è‡ªå®šä¹‰Datasetï¼ˆç”¨äºè®­ç»ƒï¼‰
â”‚   â”œâ”€â”€ dataloader.py             # DataLoaderæ„å»º
â”‚   â”œâ”€â”€ split_dataset.py          # åˆ’åˆ†train/val/test
â”‚   â””â”€â”€ enhance/                  # æ•°æ®å¢å¼º
â”‚       â”œâ”€â”€ geometric.py          # æ—‹è½¬ã€ç¿»è½¬
â”‚       â”œâ”€â”€ color.py              # äº®åº¦ã€å¯¹æ¯”åº¦
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ models/                       # ğŸ§  æ¨¡å‹å®šä¹‰ä¸æ„å»º
â”‚   â”œâ”€â”€ backbone/                 # ä¸»å¹²ç½‘ç»œï¼ˆResNet, ConvNeXtç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ resnet.py
â”‚   â”‚   â”œâ”€â”€ convnext.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ heads/                    # åˆ†ç±»å¤´ï¼ˆArcFaceç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ arcface.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ build_model.py            # æ„å»ºå®Œæ•´æ¨¡å‹
â”‚   â””â”€â”€ zoo/                      # é¢„è®­ç»ƒæƒé‡ç¼“å­˜
â”‚       â””â”€â”€ convnext_tiny.pth
â”‚
â”œâ”€â”€ features/                     # ğŸ” ç‰¹å¾æå–ä¸åŒ¹é…
â”‚   â”œâ”€â”€ extractor.py              # ç‰¹å¾æå–å™¨ï¼ˆæ¨ç†ç”¨ï¼‰
â”‚   â”œâ”€â”€ registry.py               # ç‰¹å¾æ³¨å†Œä¸ç›¸ä¼¼æ€§æœç´¢
â”‚   â””â”€â”€ storage/                  # ç‰¹å¾å­˜å‚¨
â”‚       â””â”€â”€ index.faiss           # FAISSå‘é‡ç´¢å¼•æ–‡ä»¶
â”‚
â”œâ”€â”€ database/                     # ğŸ’¾ æ•°æ®åº“æ¨¡å—ï¼ˆSQLite + CRUDï¼‰
â”‚   â”œâ”€â”€ schema.sql                # è¡¨ç»“æ„SQL
â”‚   â”œâ”€â”€ db_manager.py             # æ•°æ®åº“æ“ä½œå°è£…
â”‚   â””â”€â”€ goods.db                  # å•†å“æ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼Œ.gitignoreï¼‰
â”‚
â”œâ”€â”€ engine/                       # âš™ï¸ æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ trainer.py                # è®­ç»ƒæµç¨‹æ§åˆ¶
â”‚   â”œâ”€â”€ validator.py              # éªŒè¯ä¸è¯„ä¼°
â”‚   â””â”€â”€ inference.py              # å®æ—¶æ¨ç†å¼•æ“
â”‚
â”œâ”€â”€ segmentation/                 # âœ‚ï¸ YOLOå®ä¾‹åˆ†å‰²
â”‚   â”œâ”€â”€ yolo_segment.py           # YOLOv8åˆ†å‰²æ¥å£
â”‚   â””â”€â”€ postprocess.py            # æ©ç å¤„ç†ã€æ‘†æ­£ã€è£å‰ª
â”‚
â”œâ”€â”€ gui/                          # ğŸ–¥ï¸ å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆPyQt5/6ï¼‰
â”‚   â”œâ”€â”€ main_window.py            # ä¸»çª—å£
â”‚   â”œâ”€â”€ widgets/                  # è‡ªå®šä¹‰æ§ä»¶
â”‚   â”‚   â”œâ”€â”€ video_widget.py       # è§†é¢‘æµæ˜¾ç¤º
â”‚   â”‚   â”œâ”€â”€ product_list.py       # ç»“ç®—æ¸…å•
â”‚   â”‚   â”œâ”€â”€ status_bar.py         # çŠ¶æ€æ ï¼ˆFPSã€è®¾å¤‡ï¼‰
â”‚   â”‚   â””â”€â”€ control_panel.py      # æ§åˆ¶æŒ‰é’®
â”‚   â”œâ”€â”€ dialogs/                  # å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ register_dialog.py    # æ–°å“æ³¨å†Œ
â”‚   â”‚   â”œâ”€â”€ payment_dialog.py     # æ”¯ä»˜ç¡®è®¤
â”‚   â”‚   â””â”€â”€ error_dialog.py       # é”™è¯¯æç¤º
â”‚   â”œâ”€â”€ resources/                # èµ„æºæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ icons/                # å›¾æ ‡
â”‚   â”‚   â”œâ”€â”€ styles/               # æ ·å¼è¡¨ï¼ˆQSSï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ dark_theme.qss
â”‚   â”‚   â””â”€â”€ sounds/               # æç¤ºéŸ³æ•ˆ
â”‚   â”œâ”€â”€ themes/                   # ä¸»é¢˜ç®¡ç†
â”‚   â””â”€â”€ utils/                    # GUIå·¥å…·
â”‚       â”œâ”€â”€ screen_capture.py     # æˆªå›¾æ³¨å†Œ
â”‚       â””â”€â”€ qt_logger.py          # æ—¥å¿—æ˜¾ç¤ºåˆ°ç•Œé¢
â”‚
â”œâ”€â”€ modules/                      # ğŸ§© è‡ªå®šä¹‰ç½‘ç»œç»“æ„
â”‚   â””â”€â”€ custom_net.py
â”‚
â”œâ”€â”€ utils/                        # ğŸ› ï¸ å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ logger.py                 # åŒæ—¥å¿—ç³»ç»Ÿï¼ˆè®­ç»ƒ + ç³»ç»Ÿï¼‰
â”‚   â”œâ”€â”€ io.py                     # æ–‡ä»¶è¯»å†™ã€pickleã€json
â”‚   â”œâ”€â”€ visualization.py          # t-SNEã€ç‰¹å¾å¯è§†åŒ–
â”‚   â”œâ”€â”€ timer.py                  # æ€§èƒ½æµ‹è¯•
â”‚   â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ logs/                         # ğŸ“ æ—¥å¿—è¾“å‡º
â”‚   â”œâ”€â”€ train/                    # ğŸ”µ è®­ç»ƒæ—¥å¿—ï¼ˆTensorBoardï¼‰
â”‚   â”‚   â””â”€â”€ 20250810_143045/
â”‚   â”‚       â”œâ”€â”€ events.out.tfevents.*
â”‚   â”‚       â”œâ”€â”€ metrics.txt
â”‚   â”‚       â””â”€â”€ checkpoints/
â”‚   â””â”€â”€ system/                   # ğŸŸ¢ ç³»ç»Ÿè¿è¡Œæ—¥å¿—ï¼ˆæ–‡æœ¬ï¼‰
â”‚       â”œâ”€â”€ 2025-08-10.log
â”‚       â”œâ”€â”€ 2025-08-11.log
â”‚       â””â”€â”€ system.log -> latest
â”‚
â”œâ”€â”€ scripts/                      # â–¶ï¸ ç”¨æˆ·å…¥å£è„šæœ¬
â”‚   â”œâ”€â”€ train.py                  # å¯åŠ¨è®­ç»ƒ
â”‚   â”œâ”€â”€ infer.py                  # å¯åŠ¨GUIç»“ç®—ç³»ç»Ÿ
â”‚   â””â”€â”€ register.py               # ç‹¬ç«‹æ³¨å†Œè„šæœ¬ï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ tests/                        # âœ… å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_db.py
â”‚   â”œâ”€â”€ test_feature.py
â”‚   â””â”€â”€ test_segmentation.py
â”‚
â”œâ”€â”€ docs/                         # ğŸ“š æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ API.md
â”‚   â””â”€â”€ USER_GUIDE.md
â”‚
â”œâ”€â”€ requirements.txt              # ä¾èµ–åŒ…
â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â””â”€â”€ main.py                       # ä¸»ç¨‹åºå…¥å£ï¼ˆå¯é€‰ï¼Œå»ºè®®ç”¨scriptsï¼‰
```

ç³»ç»Ÿå·¥ä½œæµç¨‹å›¾

```mermaid
graph TD
    A[æ‘„åƒå¤´å®æ—¶è§†é¢‘æµ] --> B{GUI: main_window.py}
    B --> C[è§¦å‘è¯†åˆ«]
    C --> D[segmentation/yolo_segment.py]
    D --> E[åˆ†å‰²å‡ºå•†å“åŒºåŸŸ]
    E --> F[postprocess.py: æ‘†æ­£ + è£å‰ª]
    F --> G[features/extractor.py]
    G --> H[æå–512ç»´ç‰¹å¾å‘é‡]
    H --> I[features/registry.py]
    I --> J[FAISSå‘é‡æ£€ç´¢]
    J --> K[database/db_manager.py]
    K --> L[æŸ¥è¯¢å•†å“ä¿¡æ¯: åç§°/ä»·æ ¼]
    L --> M[GUI: æ˜¾ç¤ºè¯†åˆ«ç»“æœ]
    M --> N[ç”¨æˆ·ç¡®è®¤ç»“ç®—]
    N --> O[ç”Ÿæˆäº¤æ˜“è®°å½•]
    O --> P[å†™å…¥ system log]
    P --> Q[æ‰“å°å°ç¥¨/æ‰«ç æ”¯ä»˜]

    R[ç®¡ç†å‘˜æ³¨å†Œæ–°å“] --> S[GUI: register_dialog.py]
    S --> T[æ‹ç…§ + è¾“å…¥ä¿¡æ¯]
    T --> U[åˆ†å‰²æ‘†æ­£]
    U --> V[æå–ç‰¹å¾]
    V --> W[å­˜å…¥ database + FAISS]
    W --> X[å†™å…¥ system log]

```

GUIå¸ƒå±€è®¾è®¡

```
+-------------------------------------------------------------+
| æ™ºèƒ½å•†å“ç»“ç®—ç³»ç»Ÿ                            [æœ€å°åŒ–] [å…³é—­] |
+----------------------------+--------------------------------+
|                            |                                |
|   ğŸ“¹ å®æ—¶è§†é¢‘ç”»é¢           |    ğŸ§¾ ç»“ç®—æ¸…å•                   |
|   ï¼ˆå¸¦è¯†åˆ«æ¡†ï¼‰              |                                 |
|                            |  â€¢ å†œå¤«å±±æ³‰ 550ml  Ã—1  2.50å…ƒ    |
|                            |  â€¢ å¨ƒå“ˆå“ˆçº¯å‡€æ°´  Ã—1  2.00å…ƒ      |
|                            |                                |
|                            |    ğŸ§® æ€»ä»·ï¼š4.50å…ƒ              |
|                            |                                |
+----------------------------+--------------------------------+
|  [ğŸ“· æ³¨å†Œæ–°å“]   [âœ… ç»“ç®—]   [ğŸ—‘ï¸ æ¸…ç©º]     [âš™ï¸ è®¾ç½®]          |
+-------------------------------------------------------------+
| çŠ¶æ€: æ­£å¸¸ | FPS: 18 | è®¾å¤‡: Camera0 | æ•°æ®åº“: OK | æ—¶é—´: 10:16 |
+-------------------------------------------------------------+
```

å¤šçº¿ç¨‹æœ‰é—®é¢˜

```
UIçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰
   â†“
QTimer è§¦å‘ â†’ è¯»å¸§ â†’ å¯åŠ¨ã€åå°çº¿ç¨‹æ¨ç†ã€‘
   â†“
ä¸»çº¿ç¨‹ç»§ç»­å“åº”ç‚¹å‡»ã€åŠ¨ç”»ç­‰ï¼ˆä¸å¡ï¼‰
   â†“
åå°çº¿ç¨‹å®Œæˆæ¨ç† â†’ å‘ä¿¡å·
   â†“
ä¸»çº¿ç¨‹æ¥æ”¶ä¿¡å· â†’ æ˜¾ç¤ºç»“æœ
```

çº¿ç¨‹æ¶æ„çš„è®¾è®¡

```python
+---------------------+
|   è§†é¢‘æºè¯»å–å±‚        |
|   - QTimer           |
|   - è¯»æ‘„åƒå¤´/è§†é¢‘     |
|   - æäº¤å¸§ç»™ InferenceManager |
+----------+----------+
           â†“ submit_frame()
+----------v----------+
|   æ¨ç†å¤„ç†å±‚          | â† QRunnable + QThreadPool
|   InferenceManager    |
|                     |
|   - æ¨¡å‹æµæ°´çº¿        |
|   - åå°çº¿ç¨‹æ±         |
|   - å¸§é˜Ÿåˆ—ï¼ˆå¯é€‰ï¼‰     |
|   - æ‰§è¡Œ Seg/Track/Cls |
+----------+----------+
           â†“ ä¿¡å· â†’ on_result()
+----------v----------+
|   UI æ˜¾ç¤ºå±‚           |
|   - QLabel æ˜¾ç¤ºç»“æœ   |
|   - æ›´æ–°é‡‘é¢/æ—¥å¿—     |
+---------------------+
```

æ¶æ„è®¾è®¡

```
[ä¸»çº¿ç¨‹]                          [å­çº¿ç¨‹]                     [ä¸»çº¿ç¨‹]
   â†“                                 â†“                           â†“
è¯»å–ä¸€å¸§ frame                  æ‰§è¡Œæ¨¡å‹æ¨ç†                   æ›´æ–° UI
   â†“                                 â†“                           â†“
InferenceManager.submit_frame()   run() â†’ Seg+Track+Cls      on_result() æ˜¾ç¤º
   â†“                                 â†“                           â†“
æ”¾å…¥çº¿ç¨‹æ± é˜Ÿåˆ—                  å¤„ç†å®Œæˆå emit ä¿¡å·         æ¥æ”¶ä¿¡å·ï¼Œæ›´æ–° label
```

å°†åå¤„ç†æ¨åˆ°GPU

```
pip install -i https://mirrors.aliyun.com/pypi/simple/ cupy-cuda11x --trusted-host mirrors.aliyun.com
```

```
pip install -i https://mirrors.aliyun.com/pypi/simple/ cucim --trusted-host mirrors.aliyun.com
```

```
import cupy as cp
import cucim as cc

print("CuPy version:", cp.__version__)
print("CuPy CUDA version:", cp.cuda.runtime.runtimeGetVersion())

# åˆ›å»ºä¸€ä¸ªç®€å•çš„ GPU æ•°ç»„
x = cp.array([1, 2, 3])
print("CuPy array:", x)
print("Is x on GPU?", isinstance(x, cp.ndarray))

# æµ‹è¯• cucim
import numpy as np
data = np.random.rand(128, 128).astype(np.float32)
data_gpu = cp.asarray(data)
transformed = cc.skimage.transform.rotate(data_gpu, angle=45)
print("cucim rotate test passed. Output shape:", transformed.shape)
```

torch

```
pip install kornia -i https://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com
```

